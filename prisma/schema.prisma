generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int            @id @default(autoincrement())
  username      String         @unique
  password_hash String
  role          String         // 'doctor', 'nurse', 'admin'
  created_at    DateTime       @default(now())
  prescriptions Prescription[]

  @@map("users")
}

model Patient {
  id            Int         @id @default(autoincrement())
  full_name     String
  date_of_birth DateTime    @db.Date
  gender        String      // 'male', 'female', 'other'
  phone         String?
  created_at    DateTime    @default(now())
  encounters    Encounter[]

  @@map("patients")
}

model Encounter {
  id             Int            @id @default(autoincrement())
  patient_id     Int
  clinician_role String
  notes          String?
  created_at     DateTime       @default(now())
  patient        Patient        @relation(fields: [patient_id], references: [id])
  prescriptions  Prescription[]

  @@map("encounters")
}

model Prescription {
  id           Int       @id @default(autoincrement())
  encounter_id Int
  drug_name    String
  dosage       String
  frequency    String
  duration     String
  created_by   Int
  created_at   DateTime  @default(now())
  encounter    Encounter @relation(fields: [encounter_id], references: [id])
  creator      User      @relation(fields: [created_by], references: [id])

  @@map("prescriptions")
}

model AuditLog {
  id          Int      @id @default(autoincrement())
  user_role   String
  action      String
  entity_type String
  entity_id   Int?
  timestamp   DateTime @default(now())

  @@map("audit_logs")
}
